{{- if .is_mac -}}
#!/bin/bash

set -euo pipefail

# Include common functions
{{ template "common.tmpl" . }}

PLIST="$HOME/Library/LaunchAgents/com.local.KeyRemapping.plist"

if [ -f "$PLIST" ]; then
    # Unload first if already loaded (ignore errors)
    launchctl unload "$PLIST" 2>/dev/null || true

    # Load the LaunchAgent
    launchctl load "$PLIST"
    log_success "Keyboard modifier keys configured (Caps Lock → Control, Control → No Action)"
else
    log_error "LaunchAgent not found: $PLIST"
fi
{{- end -}}
